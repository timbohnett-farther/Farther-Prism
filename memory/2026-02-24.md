

## AI-Driven Risk Profile Questionnaire (Feb 24, 2026)

### What We Built
Replaced static risk assessment with dynamic AI-powered questionnaire:

**Frontend (TypeScript + React):**
- `types/risk.ts` - Type definitions (Question, Answer, BIT, RiskTier, AssessmentResult)
- `services/riskInterviewService.ts` - API client for question generation
- `services/riskScoringService.ts` - Deterministic scoring engine
- `components/RiskQuestionnaire.tsx` - Dynamic interview UI with predictive prefetching
- `components/RiskResults.tsx` - Results dashboard with charts
- `components/RiskAssessment.jsx` - Main orchestrator (welcome → questionnaire → results)

**Backend (Node.js + Claude):**
- `src/services/riskAIService.js` - Claude 3.5 Sonnet integration
- `src/server.js` - Route: `POST /api/risk/generate-question`
- Adaptive question generation based on wealth tier, experience, and answer history

**Key Features:**
- **Predictive prefetching**: Generates next question as user selects answer (zero latency)
- **Adaptive logic**: Questions adapt to wealth tier (emerging → UHNW) and risk profile
- **Behavioral Investor Type**: 5-level classification (Highly Emotional → Hyper-Cognitive)
- **Dual-dimension scoring**: Risk Capacity (financial) vs Risk Willingness (behavioral)
- **Compliance trail**: Every question includes AI rationale (DOL PTE 2020-02)
- **10-tier allocation**: Conservative → All-In Growth with specific asset mixes

**Technical Excellence:**
- TypeScript for type safety
- Race condition prevention in prefetching (useRef)
- Fallback questions if AI fails
- Recharts for beautiful data viz
- Farther branding throughout

**Status:** Committed (cee37a8), Railway auto-deploying (~2 min)


## Calculation Engine Build Session (Feb 24, 2026 02:30-03:00 UTC)

### What Tim Wants
- Complete institutional-grade financial planning platform (8-week timeline)
- Bloomberg API access (getting credentials tomorrow)
- Keep building calculation engine while waiting

### What I Built Tonight

**1. Monthly Cash Flow Engine** (`src/calculation/cashflow-engine.js`)
- Income projection with inflation
- Expense tracking (essential vs discretionary vs debt service)
- Emergency fund logic (6-month target, 10% surplus allocation)
- Debt payoff schedules with monthly amortization
- Social Security, pension, business income support
- **Key:** Monthly time-stepping (not annual) for institutional accuracy

**2. Account Balance Tracker** (`src/calculation/account-tracker.js`)
- Monthly account evolution (contributions, withdrawals, growth)
- IRS contribution limits (401k: $23K, IRA: $7K, HSA: $4.15K in 2024)
- Catch-up contributions (age 50+)
- Employer match calculation (401k)
- Contribution priority: 401k match → Roth IRA → Trad IRA → Taxable
- Withdrawal sequencing: Taxable → Trad IRA → Roth (preserve Roth for legacy)
- Tax withholding on distributions
- Portfolio growth by asset class allocation
- **Integration point:** `getMonthlyReturn()` will use Bloomberg for real portfolio pricing

**3. RMD Engine** (`src/calculation/rmd-engine.js`)
- IRS Uniform Lifetime Table (2022+)
- SECURE 2.0 rules: Age 73 (born 1951-59) or 75 (born 1960+)
- Annual RMD calculations (balance / life expectancy factor)
- Inherited IRA 10-year rule enforcement
- QCD (Qualified Charitable Distribution) opportunities (age 70.5+, up to $105K)
- Multi-account aggregation (IRAs can be combined, 401ks must be separate)
- Penalty tracking (25% of shortfall if RMD not taken)

### Progress Update
- **Overall:** ~40% complete (up from 35%)
- **Weeks 1-2 (Foundation):** ✅ Complete
- **Week 3 (Calculation Engine):** 50% complete
  - ✅ Cash flow engine
  - ✅ Account tracker
  - ✅ RMD engine
  - ⏳ Tax calculator (next - hardest part)
  - ⏳ Roth conversion optimizer
  - ⏳ Social Security integration

### Next Steps (Week 3-4 Completion)
1. **Tax Calculator** (5 days) - HARD PROBLEM
   - Federal + State + IRMAA + NIIT
   - Fixed-point solver (withdrawals ↔ tax circular dependency)
   - Monthly accrual for accuracy
2. **Roth Conversion Optimizer** (2 days)
   - Fill tax brackets efficiently
   - Avoid IRMAA cliffs
3. **Social Security Integration** (1 day)
   - Claiming age optimization
   - COLA adjustments
   - Spousal/survivor benefits
4. **Portfolio Growth Model** (2 days)
   - Bloomberg integration (once we have credentials)
   - Stochastic returns for Monte Carlo
   - Rebalancing logic

### Bloomberg Discussion
- Tim has access to Bloomberg API (institutional-grade data source)
- **Huge competitive advantage** over eMoney/RightCapital
- Coverage: Stocks, bonds, ETFs, mutual funds, alternatives, global markets
- Will get credentials tomorrow
- Integration point ready in `account-tracker.js`

### Roadmap Status
- Created comprehensive `ROADMAP-STATUS.md` document
- 8-week timeline on track
- Critical path: Tax calculator (weeks 3-4)
- No blockers - can continue building logic while waiting for Bloomberg

